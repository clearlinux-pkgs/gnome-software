From 65cf3e87594da11fb03e7eb3d6bf4768b4a3d8ab Mon Sep 17 00:00:00 2001
From: Auke Kok <auke-jan.h.kok@intel.com>
Date: Mon, 14 Jan 2019 14:58:30 -0800
Subject: [PATCH 2/4] Search for, and show icons from
 /usr/share/clear/bundle-icons/.

---
 plugins/swupd/gs-plugin-swupd.c | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/plugins/swupd/gs-plugin-swupd.c b/plugins/swupd/gs-plugin-swupd.c
index 0ef70f50..1a8b4205 100644
--- a/plugins/swupd/gs-plugin-swupd.c
+++ b/plugins/swupd/gs-plugin-swupd.c
@@ -65,6 +65,7 @@ gs_plugin_swupd_create_app (GsApp *app,
     gchar *file_path = g_strdup_printf ("/usr/share/clr-bundles/%s", bundle_name);
     gchar **file_lines = NULL;
     gchar *desc = NULL;
+    g_autofree gchar *icon_path = NULL;
 
     g_debug ("file name %s", file_path);
     
@@ -86,6 +87,14 @@ gs_plugin_swupd_create_app (GsApp *app,
         }
     }
 
+    // Add icon if found
+    icon_path = g_strdup_printf("/usr/share/clear/bundle-icons/%s.svg", bundle_name);
+    if (!g_file_test(icon_path, G_FILE_TEST_EXISTS))
+        icon_path = g_strdup_printf("/usr/share/clear/bundle-icons/%s.png", bundle_name);
+    if (!g_file_test(icon_path, G_FILE_TEST_EXISTS))
+        icon_path = g_strdup("/usr/share/clear/bundle-icons/bundle.svg");
+    gs_app_set_pixbuf (app, gdk_pixbuf_new_from_file (icon_path, NULL));
+
     gs_app_set_name (app, GS_APP_QUALITY_NORMAL, bundle_name);
     gs_app_set_url (app, AS_URL_KIND_HOMEPAGE, "https://clearlinux.org/documentation/clear-linux/concepts/bundles-about");
     gs_app_set_kind (app, AS_APP_KIND_DESKTOP);
@@ -94,7 +103,6 @@ gs_plugin_swupd_create_app (GsApp *app,
     } else {
         gs_app_set_state (app, AS_APP_STATE_AVAILABLE);
     }
-    gs_app_set_pixbuf (app, gdk_pixbuf_new_from_file ("/usr/share/icons/hicolor/48x48/actions/geany-close-all.png", NULL));
     gs_app_add_category (app, "Utility");
     gs_app_set_summary (app, GS_APP_QUALITY_NORMAL, desc);
 
-- 
2.20.0

